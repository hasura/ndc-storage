packagingDefinition:
  type: PrebuiltDockerImage
  dockerImage: ghcr.io/hasura/ndc-storage:{{VERSION}}
documentationPage: https://github.com/hasura/ndc-storage
supportedEnvironmentVariables:
  - name: ACCESS_KEY_ID
    description: The access key ID
    required: true
  - name: SECRET_ACCESS_KEY
    description: The secret access key
    required: true
  - name: STORAGE_ENDPOINT
    description: The base endpoint of the storage service. Required if the provider is another S3 compatible service such as MinIO, Cloudflare R2.
    required: false
  - name: DEFAULT_BUCKET
    description: The default bucket to be used. If not set the client must input the bucket in input arguments
    required: false
nativeToolchainDefinition:
  commands:
    start:
      type: ShellScript
      bash: |
        #!/usr/bin/env bash
        set -eu -o pipefail        
        HASURA_CONFIGURATION_DIRECTORY="$HASURA_PLUGIN_CONNECTOR_CONTEXT_PATH" "$HASURA_DDN_NATIVE_CONNECTOR_DIR/ndc-cli" serve
      powershell: |
        $ErrorActionPreference = "Stop"
        $env:HASURA_CONFIGURATION_DIRECTORY="$env:HASURA_PLUGIN_CONNECTOR_CONTEXT_PATH"; & "$env:HASURA_DDN_NATIVE_CONNECTOR_DIR\ndc-cli.exe" serve
    update:
      type: ShellScript
      bash: |
        #!/usr/bin/env bash
        set -eu -o pipefail
        "$HASURA_DDN_NATIVE_CONNECTOR_PLUGIN_DIR/hasura-ndc-storage" update
      powershell: |
        $ErrorActionPreference = "Stop"
        & "$env:HASURA_DDN_NATIVE_CONNECTOR_PLUGIN_DIR\hasura-ndc-storage.exe" update
    watch:
      type: ShellScript
      bash: |
        #!/usr/bin/env bash
        echo "Watch is not supported for this connector"
        exit 1
      powershell: |
        Write-Output "Watch is not supported for this connector"
        exit 1
commands:
  update: hasura-ndc-storage update
  upgradeConfiguration: hasura-ndc-storage version
cliPlugin:
  name: ndc-storage
  version: "{{VERSION}}"
dockerComposeWatch:
  # copy config files into the existing container and restart it
  - path: ./configuration.yaml
    target: /etc/connector/configuration.yaml
    action: sync+restart
