---
kind: ObjectType
version: v1
definition:
  name: ServerSideEncryptionConfiguration
  description: is the default encryption configuration structure.
  fields:
    - name: kmsMasterKeyId
      type: String
    - name: sseAlgorithm
      type: String
  graphql:
    typeName: ServerSideEncryptionConfiguration
    inputTypeName: ServerSideEncryptionConfigurationInput
  dataConnectorTypeMapping:
    - dataConnectorName: storage
      dataConnectorObjectType: ServerSideEncryptionConfiguration

---
kind: TypePermissions
version: v1
definition:
  typeName: ServerSideEncryptionConfiguration
  permissions:
    - role: admin
      output:
        allowedFields:
          - kmsMasterKeyId
          - sseAlgorithm

---
kind: ObjectType
version: v1
definition:
  name: AbortIncompleteMultipartUpload
  description: structure, not supported yet on MinIO
  fields:
    - name: daysAfterInitiation
      type: Int32
  graphql:
    typeName: AbortIncompleteMultipartUpload
    inputTypeName: AbortIncompleteMultipartUploadInput
  dataConnectorTypeMapping:
    - dataConnectorName: storage
      dataConnectorObjectType: AbortIncompleteMultipartUpload

---
kind: TypePermissions
version: v1
definition:
  typeName: AbortIncompleteMultipartUpload
  permissions:
    - role: admin
      output:
        allowedFields:
          - daysAfterInitiation

---
kind: ObjectType
version: v1
definition:
  name: LifecycleAllVersionsExpiration
  description: represents AllVersionsExpiration actions element in an ILM policy
  fields:
    - name: days
      type: Int32
    - name: deleteMarker
      type: Boolean
  graphql:
    typeName: LifecycleAllVersionsExpiration
    inputTypeName: LifecycleAllVersionsExpirationInput
  dataConnectorTypeMapping:
    - dataConnectorName: storage
      dataConnectorObjectType: LifecycleAllVersionsExpiration

---
kind: TypePermissions
version: v1
definition:
  typeName: LifecycleAllVersionsExpiration
  permissions:
    - role: admin
      output:
        allowedFields:
          - days
          - deleteMarker

---
kind: ObjectType
version: v1
definition:
  name: LifecycleDelMarkerExpiration
  description: represents DelMarkerExpiration actions element in an ILM policy
  fields:
    - name: days
      type: Int32
  graphql:
    typeName: LifecycleDelMarkerExpiration
    inputTypeName: LifecycleDelMarkerExpirationInput
  dataConnectorTypeMapping:
    - dataConnectorName: storage
      dataConnectorObjectType: LifecycleDelMarkerExpiration

---
kind: TypePermissions
version: v1
definition:
  typeName: LifecycleDelMarkerExpiration
  permissions:
    - role: admin
      output:
        allowedFields:
          - days

---
kind: ObjectType
version: v1
definition:
  name: LifecycleExpiration
  description: expiration details of lifecycle configuration
  fields:
    - name: date
      type: Date
    - name: days
      type: Int32
    - name: expiredObjectAllVersions
      type: Boolean
    - name: expiredObjectDeleteMarker
      type: Boolean
  graphql:
    typeName: LifecycleExpiration
    inputTypeName: LifecycleExpirationInput
  dataConnectorTypeMapping:
    - dataConnectorName: storage
      dataConnectorObjectType: LifecycleExpiration

---
kind: TypePermissions
version: v1
definition:
  typeName: LifecycleExpiration
  permissions:
    - role: admin
      output:
        allowedFields:
          - date
          - days
          - expiredObjectAllVersions
          - expiredObjectDeleteMarker

---
kind: ObjectType
version: v1
definition:
  name: LifecycleFilterAnd
  description: the And Rule for LifecycleTag, to be used in LifecycleRuleFilter
  fields:
    - name: objectSizeGreaterThan
      type: Int64
    - name: objectSizeLessThan
      type: Int64
    - name: prefix
      type: String
    - name: tags
      type: "[StorageTag!]"
  graphql:
    typeName: LifecycleFilterAnd
    inputTypeName: LifecycleFilterAndInput
  dataConnectorTypeMapping:
    - dataConnectorName: storage
      dataConnectorObjectType: LifecycleFilterAnd

---
kind: TypePermissions
version: v1
definition:
  typeName: LifecycleFilterAnd
  permissions:
    - role: admin
      output:
        allowedFields:
          - objectSizeGreaterThan
          - objectSizeLessThan
          - prefix
          - tags

---
kind: ObjectType
version: v1
definition:
  name: LifecycleFilter
  description: will be used in selecting rule(s) for lifecycle configuration
  fields:
    - name: and
      type: LifecycleFilterAnd
    - name: objectSizeGreaterThan
      type: Int64
    - name: objectSizeLessThan
      type: Int64
    - name: prefix
      type: String
    - name: tag
      type: StorageTag
  graphql:
    typeName: LifecycleFilter
    inputTypeName: LifecycleFilterInput
  dataConnectorTypeMapping:
    - dataConnectorName: storage
      dataConnectorObjectType: LifecycleFilter

---
kind: TypePermissions
version: v1
definition:
  typeName: LifecycleFilter
  permissions:
    - role: admin
      output:
        allowedFields:
          - and
          - objectSizeGreaterThan
          - objectSizeLessThan
          - prefix
          - tag

---
kind: ObjectType
version: v1
definition:
  name: LifecycleNoncurrentVersionExpiration
  description: "- Specifies when noncurrent object versions expire. Upon
    expiration, server permanently deletes the noncurrent object versions. Set
    this lifecycle configuration action on a bucket that has versioning enabled
    (or suspended) to request server delete noncurrent object versions at a
    specific period in the object's lifetime."
  fields:
    - name: newerNoncurrentVersions
      type: Int32
    - name: noncurrentDays
      type: Int32
  graphql:
    typeName: LifecycleNoncurrentVersionExpiration
    inputTypeName: LifecycleNoncurrentVersionExpirationInput
  dataConnectorTypeMapping:
    - dataConnectorName: storage
      dataConnectorObjectType: LifecycleNoncurrentVersionExpiration

---
kind: TypePermissions
version: v1
definition:
  typeName: LifecycleNoncurrentVersionExpiration
  permissions:
    - role: admin
      output:
        allowedFields:
          - newerNoncurrentVersions
          - noncurrentDays

---
kind: ObjectType
version: v1
definition:
  name: LifecycleNoncurrentVersionTransition
  description: sets this action to request server to transition noncurrent object
    versions to different set storage classes at a specific period in the
    object's lifetime.
  fields:
    - name: newerNoncurrentVersions
      type: Int32
    - name: noncurrentDays
      type: Int32
    - name: storageClass
      type: String
  graphql:
    typeName: LifecycleNoncurrentVersionTransition
    inputTypeName: LifecycleNoncurrentVersionTransitionInput
  dataConnectorTypeMapping:
    - dataConnectorName: storage
      dataConnectorObjectType: LifecycleNoncurrentVersionTransition

---
kind: TypePermissions
version: v1
definition:
  typeName: LifecycleNoncurrentVersionTransition
  permissions:
    - role: admin
      output:
        allowedFields:
          - newerNoncurrentVersions
          - noncurrentDays
          - storageClass

---
kind: ObjectType
version: v1
definition:
  name: LifecycleTransition
  description: transition details of lifecycle configuration
  fields:
    - name: date
      type: Date
    - name: days
      type: Int32
    - name: storageClass
      type: String
  graphql:
    typeName: LifecycleTransition
    inputTypeName: LifecycleTransitionInput
  dataConnectorTypeMapping:
    - dataConnectorName: storage
      dataConnectorObjectType: LifecycleTransition

---
kind: TypePermissions
version: v1
definition:
  typeName: LifecycleTransition
  permissions:
    - role: admin
      output:
        allowedFields:
          - date
          - days
          - storageClass

---
kind: ObjectType
version: v1
definition:
  name: BucketLifecycleRule
  description: represents a single rule in lifecycle configuration
  fields:
    - name: abortIncompleteMultipartUpload
      type: AbortIncompleteMultipartUpload
    - name: allVersionsExpiration
      type: LifecycleAllVersionsExpiration
    - name: delMarkerExpiration
      type: LifecycleDelMarkerExpiration
    - name: expiration
      type: LifecycleExpiration
    - name: filter
      type: LifecycleFilter
    - name: id
      type: String!
    - name: noncurrentVersionExpiration
      type: LifecycleNoncurrentVersionExpiration
    - name: noncurrentVersionTransition
      type: LifecycleNoncurrentVersionTransition
    - name: prefix
      type: String
    - name: status
      type: String
    - name: transition
      type: LifecycleTransition
  graphql:
    typeName: BucketLifecycleRule
    inputTypeName: BucketLifecycleRuleInput
  dataConnectorTypeMapping:
    - dataConnectorName: storage
      dataConnectorObjectType: BucketLifecycleRule

---
kind: TypePermissions
version: v1
definition:
  typeName: BucketLifecycleRule
  permissions:
    - role: admin
      output:
        allowedFields:
          - abortIncompleteMultipartUpload
          - allVersionsExpiration
          - delMarkerExpiration
          - expiration
          - filter
          - id
          - noncurrentVersionExpiration
          - noncurrentVersionTransition
          - prefix
          - status
          - transition

---
kind: ObjectType
version: v1
definition:
  name: BucketLifecycleConfiguration
  description: is a collection of lifecycle Rule objects.
  fields:
    - name: rules
      type: "[BucketLifecycleRule!]!"
  graphql:
    typeName: BucketLifecycleConfiguration
    inputTypeName: BucketLifecycleConfigurationInput
  dataConnectorTypeMapping:
    - dataConnectorName: storage
      dataConnectorObjectType: BucketLifecycleConfiguration

---
kind: TypePermissions
version: v1
definition:
  typeName: BucketLifecycleConfiguration
  permissions:
    - role: admin
      output:
        allowedFields:
          - rules

---
kind: ObjectType
version: v1
definition:
  name: StorageObjectLockConfig
  description: represents the object lock configuration in given bucket
  fields:
    - name: mode
      type: StorageRetentionMode
    - name: objectLock
      type: String!
    - name: unit
      type: StorageRetentionValidityUnit
    - name: validity
      type: Int32
  graphql:
    typeName: StorageObjectLockConfig
    inputTypeName: StorageObjectLockConfigInput
  dataConnectorTypeMapping:
    - dataConnectorName: storage
      dataConnectorObjectType: StorageObjectLockConfig

---
kind: TypePermissions
version: v1
definition:
  typeName: StorageObjectLockConfig
  permissions:
    - role: admin
      output:
        allowedFields:
          - mode
          - objectLock
          - unit
          - validity

---
kind: ObjectType
version: v1
definition:
  name: StorageBucketVersioningConfiguration
  description: is the versioning configuration structure
  fields:
    - name: enabled
      type: Boolean!
    - name: excludeFolders
      type: Boolean
    - name: excludedPrefixes
      type: "[String!]"
    - name: mfaDelete
      type: String
  graphql:
    typeName: StorageBucketVersioningConfiguration
    inputTypeName: StorageBucketVersioningConfigurationInput
  dataConnectorTypeMapping:
    - dataConnectorName: storage
      dataConnectorObjectType: StorageBucketVersioningConfiguration

---
kind: TypePermissions
version: v1
definition:
  typeName: StorageBucketVersioningConfiguration
  permissions:
    - role: admin
      output:
        allowedFields:
          - enabled
          - excludeFolders
          - excludedPrefixes
          - mfaDelete

---
kind: ObjectType
version: v1
definition:
  name: StorageBucketInfo
  description: container for bucket metadata.
  fields:
    - name: creationDate
      type: TimestampTz!
    - name: encryption
      type: ServerSideEncryptionConfiguration
    - name: lifecycle
      type: BucketLifecycleConfiguration
    - name: name
      type: String!
    - name: objectLock
      type: StorageObjectLockConfig
    - name: tags
      type: Json
    - name: versioning
      type: StorageBucketVersioningConfiguration
  graphql:
    typeName: StorageBucketInfo
    inputTypeName: StorageBucketInfoInput
  dataConnectorTypeMapping:
    - dataConnectorName: storage
      dataConnectorObjectType: StorageBucketInfo

---
kind: TypePermissions
version: v1
definition:
  typeName: StorageBucketInfo
  permissions:
    - role: admin
      output:
        allowedFields:
          - creationDate
          - encryption
          - lifecycle
          - name
          - objectLock
          - tags
          - versioning

---
kind: Command
version: v1
definition:
  name: StorageBuckets
  outputType: "[StorageBucketInfo!]!"
  arguments:
    - name: clientId
      type: StorageClientId
    - name: prefix
      type: String
  source:
    dataConnectorName: storage
    dataConnectorCommand:
      function: storageBuckets
  graphql:
    rootFieldName: storageBuckets
    rootFieldKind: Query
  description: list all buckets.

---
kind: CommandPermissions
version: v1
definition:
  commandName: StorageBuckets
  permissions:
    - role: admin
      allowExecution: true

